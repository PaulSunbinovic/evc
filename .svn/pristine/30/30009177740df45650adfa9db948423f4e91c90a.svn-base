//假装通过数据库获取数据
			

$(function(){
	
	$("#ctt").bind("input propertychange",function(){
		
	    var ctt=$.trim($('#ctt').val());
	    var ul="<ul  class='list-group'>";
	    var flag=0;
	    
	    if(ctt!=''){
	    	for(var i=0;i<pntarr.length;i++){
	    		if(pntarr[i]['title'].indexOf(ctt)!=-1){
			    	flag=1;
			    	ul=ul+"<li  class='list-group-item' onclick='panto(p["+pntarr[i]['deviceId']+"])'>"+pntarr[i]['title']+"</li>";
		    	}
	    	}
	    }
	    
	    if(flag==0){
	    	ul=ul+"<li  class='list-group-item'>暂无结果</li>";
	    }
	    ul=ul+"</ul><a class='btn btn-danger' style='width:100%' onclick='clspp()'>关闭搜索结果</a>";
	    $('#example').attr('data-content',ul);
	    $('#example').popover('show');
	})



	$('#apntok').click(function(){
		$.ajax({
            'type': 'GET',
            'url': apnt,
             // 'async':false, //同步异步无所谓到情况下就默认异步好了
            'contentType': 'application/json',
            'data': {
                'tp':'ok',     
            },
            'dataType': 'json',
            'success': function(data) {
                lgtd=data['apntpnt']['longitude'];
				lttd=data['apntpnt']['latitude'];
				ads=data['apntpnt']['address'];
		    	dvcid=data['apntpnt']['id'];
		  
				var apntpnt=new BMap.Point(lgtd,lttd);
				//技术储备，万一那天用得到	
				// var sContent =
				// 		"<h4 style='margin:0 0 5px 0;padding:0.2em 0'>"+ads+"</h4>" + 
				// 		"<img style='float:right;margin:4px' id='imgDemo' src='"+cdzpt+"' width='139' height='104' title=''/>" + 
				// 		"<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em;color:red'>预约此桩后，如果不赴约，须去个人中心取消此预约。</p>" + "<div class='infwdaptmt'><div><a class='pull-left btn btn-success' href='"+apntprx+"/"+dvcid+"'>确定预约</a></div></div>"
				// 		+
				// 		"</div>";
				// var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象

				
				// map.openInfoWindow(infoWindow,apntpnt); //开启信息窗口
				driving.search(mypoint, apntpnt);
            		
            		
                console.log("success");
            },
            'error':function() {
                    console.log("error");
            }
    	});
	})
});
function clspp(){
	$('#example').popover('hide');
}
function panto(pnt){
	map.panTo(pnt);
	$('#example').popover('hide');    
}

function apnt(){
	$.ajax({
            'type': 'GET',
            'url': apnt,
             // 'async':false, //同步异步无所谓到情况下就默认异步好了
            'contentType': 'application/json',
            'data': {
                'tp':'ok',     
            },
            'dataType': 'json',
            'success': function(data) {
                lgtd=data['apntpnt']['longitude'];
				lttd=data['apntpnt']['latitude'];
				ads=data['apntpnt']['address'];
		    	dvcid=data['apntpnt']['id'];
		  
				var apntpnt=new BMap.Point(lgtd,lttd);
				//技术储备，万一那天用得到	
				// var sContent =
				// 		"<h4 style='margin:0 0 5px 0;padding:0.2em 0'>"+ads+"</h4>" + 
				// 		"<img style='float:right;margin:4px' id='imgDemo' src='"+cdzpt+"' width='139' height='104' title=''/>" + 
				// 		"<p style='margin:0;line-height:1.5;font-size:13px;text-indent:2em;color:red'>预约此桩后，如果不赴约，须去个人中心取消此预约。</p>" + "<div class='infwdaptmt'><div><a class='pull-left btn btn-success' href='"+apntprx+"/"+dvcid+"'>确定预约</a></div></div>"
				// 		+
				// 		"</div>";
				// var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象

				
				// map.openInfoWindow(infoWindow,apntpnt); //开启信息窗口
				driving.search(mypoint, apntpnt);
            		
            		
                console.log("success");
            },
            'error':function() {
                    console.log("error");
            }
    	});
}