var dvcid=0;var fctswc=1;//功能性开关 1则为有实际触发功能 0为只是动画
function onoff(id){
	dvcid=id;
	var obj=$('#dvc_'+id);
	var ckd=obj.attr('checked');
	if(ckd=='checked'){
		//$('#modal').trigger('click');
        doonff('','on')
		//alert('开');
	}else{
		//alert('关');
		doonff('','off');
	}
}

function clc(id){//clock
    dvcid=id;
    $.ajax({
        'type': 'GET',
        'url': fnddvcbydvcid,
        'async':false,  
        'contentType': 'application/json',
        'data': {
            'dvcid':id,
            
        },
        'dataType': 'json',
        'success': function(data) {
               
           $('#dvcnm').html(data['dvco']['address']);
            
            console.log("success");
        },
        'error':function() {
                console.log("error");
        }
    });
    $('#modal').trigger('click');
}


$(function(){
	$('#tm').click(function(){
		//$('#tm').blur();
	})

	
	$('#cnclstttm').click(function(){
        $('#stttm').val('');
    })

    $('#cnclendtm').click(function(){
        $('#endtm').val('');
    })

    $('#sttm').click(function(){
        $.ajax({
            'type': 'GET',
            'url': dosttm,
            //'async':false,  
            'contentType': 'application/json',
            'data': {
                'optm':$('#optm').val(),
                'clstm':$('#clstm').val(),
                'dvcid':dvcid,
            },
            'dataType': 'json',
            'success': function(data) {
                $('#cls').trigger('click');
                if(data['fnlstat']==1){
                    $('#btn_'+dvcid).attr('class','btn btn-default');
                    $('#tm_'+dvcid).html('已设定');
                }else{
                    $('#btn_'+dvcid).attr('class','btn btn-sucess');
                    $('#tm_'+dvcid).html('未设定');
                }
                   
                alert(data['rslt']);

                
                console.log("success");
            },
            'error':function() {
                    console.log("error");
            }
        });
    })

    $('#cncloptm').click(function(){
        $('#optm').val('');
    })
    
})

function doonff(tm,oprt){
	if(fctswc==1){
		$.ajax({
            'type': 'GET',
            'url': doonoffdvc,
            'async':false,  
            'contentType': 'application/json',
            'data': {
                'dvcid':dvcid,
                'tm':tm,
                'oprt':oprt,
            },
            'dataType': 'json',
            'success': function(data) {
                 	
                 	//$('#cls').trigger('click');
                 	
                 	if(data.rslt=='error'){
                 		fctswc=0;//暂时不启用功能
                 		$('#dvc_'+dvcid).trigger('click');
                 		fctswc=1;//开启功能模式，下次点击再次有功能意义
                 		alert(data.msg);
                 			
             			
                 		
                 		
                 	}else{

                 	}
                 	
                    console.log("success");
            },
            'error':function() {
                    console.log("error");
            }
    	});
	}
	
}