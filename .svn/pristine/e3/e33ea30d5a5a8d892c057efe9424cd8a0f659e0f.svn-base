<?php
// 本类由系统自动生成，仅供测试用途
class IndexAction extends Action {



	public function test(){
		p($_POST);die;
	}


    public function index(){

    	import('@.WX.JssdkAction');
		$jssdk = new JssdkAction(C('appid'), C('appsecret'));
		$signPackage = $jssdk->GetSignPackage();
		$this->assign('spkg',$signPackage);

		// $url="http://api.map.baidu.com/geosearch/v3/nearby?ak=S0VAW4LjQirp9FUmXF08Zvdy&geotable_id=116349&location=120.363991,30.32658&radius=1000";
		// $result=https_request($url);
		// $array=json_decode($result,TRUE);


		// $this->assign('cdzls',$array['contents']);
		// ojxMBuJe07gSZDUwp0ZHGHEMHOR8
		// --------------------------为了有用户进行测试我就牺牲下拿我到微信号来测了
		session('openid','12345');


		
		


		$lth=$_GET['lth'];
		if($lth==1000){
			$lvl=15;
		}else if($lth==2500){
			$lvl=14;
		}else if($lth==5000){
			$lvl=13;
		}else if($lth==10000){
			$lvl=12;
		}else if($lth=='all'){
			$lvl=11;
		}else{//默认
			$lvl=15;
		}
		$this->assign('lvl',$lvl);
		$this->assign('tbid',C('tbid'));

		$this->display('index');
	}

	

	public function apnt(){

    	
		

		if($_GET['tp']=='ok'){//type onekey//一键获取点的话，需要算出最近点，然后产生订单
			//到时看马哥是不是给算出最近的点，我现在先假定我已经得到了
			$mstnr='{"id":4,"owner":2,"sn":"004","model":1,"city":null,"longitude":"121.570077","latitude":"31.219745","address":"上海浦东嘉里大酒店桩","peripheral":null,"ip":null,"serverIp":null,"serverPort":null,"pic":"","battery":0,"status":""}';//most near
			$apntpnt=json_decode($mstnr,true);
			
		}else{//普通的话就需要直接获得装ID根据桩id 来进行
			
		}
		
		$data['apntpnt']=$apntpnt;
		$this->ajaxReturn($data,'json');

		
	}

}