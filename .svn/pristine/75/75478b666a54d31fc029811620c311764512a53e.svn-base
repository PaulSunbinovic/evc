var dvcid=0;var fctswc=1;//功能性开关 1则为有实际触发功能 0为只是动画
function onoff(id){
	dvcid=id;
	var obj=$('#dvc_'+id);
	var ckd=obj.attr('checked');
	if(ckd=='checked'){
		$('#modal').trigger('click');
		//alert('开');
	}else{
		//alert('关');
		doonff('','off');
	}
}



$(function(){
	$('#tm').click(function(){
		//$('#tm').blur();
	})

	
	$('#cplt').click(function(){

		doonff('','on');
	})
	$('#dingshicplt').click(function(){
		if($('#tm').val()==''){
			alert('定时的时间不能为空！');
			return false;
		}
		doonff($('#tm').val(),'on');
	})


    
})

function doonff(tm,oprt){
	if(fctswc==1){
		$.ajax({
        'type': 'GET',
        'url': doonoffdvc,
        'async':false,  
        'contentType': 'application/json',
        'data': {
            'dvcid':dvcid,
            'tm':tm,
            'oprt':oprt,
        },
        'dataType': 'json',
        'success': function(data) {
             	
             	$('#cls').trigger('click');
             	
             	if(data.rslt=='error'){
             		fctswc=0;//暂时不启用功能
             		$('#dvc_'+dvcid).trigger('click');
             		fctswc=1;//开启功能模式，下次点击再次有功能意义
             		alert(data.msg);
             			
         			
             		
             		
             	}else{

             	}
             	
                console.log("success");
        },
        'error':function() {
                console.log("error");
        }
	});
	}
	
}